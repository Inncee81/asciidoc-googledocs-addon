<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons.css">
<style>
@-webkit-keyframes spinAround {
  from {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  to {
    -webkit-transform: rotate(359deg);
            transform: rotate(359deg);
  }
}
@keyframes spinAround {
  from {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  to {
    -webkit-transform: rotate(359deg);
            transform: rotate(359deg);
  }
}

#spinner {
  animation: spinAround 500ms infinite linear;
  border: 2px solid #363636;
  border-radius: 290486px;
  border-right-color: transparent;
  border-top-color: transparent;
  height: 1.5em;
  width: 1.5em;
  left: calc(50% - (1em / 2));
  top: calc(50% - (1em / 2));
  margin-right: 1em;
}

#panel {
  display: flex;
}

#message {
  color: #363636;
  align-self: center;
}

#asciidoc-text {
  width: 100%
}

h2 {
  color: #363636;
}

.is-hidden {
  display: none !important;
}
</style>

<div>
  <div id="panel" class="block">
    <div id="spinner"></div>
    <div id="message">Converting...</div>
  </div>
  <div>
    <textarea class="is-hidden" id="asciidoc-text" rows="20"></textarea>
  </div>
</div>

<script>
  // Runs a server-side function to generate AsciiDoc
  function convertAsciiDoc() {
    google.script.run
        .withSuccessHandler(
          function(asciidoc) {
            document.getElementById('spinner').classList.add('is-hidden');
            var asciidocTextElement = document.getElementById('asciidoc-text');
            asciidocTextElement.classList.remove('is-hidden');
            asciidocTextElement.value = asciidoc;
            var titleElement = document.createElement('h2');
            titleElement.innerText = 'Result';
            var messageElement = document.getElementById('message');
            messageElement.innerText = '';
            messageElement.appendChild(titleElement);
          })
        .withFailureHandler(
          function(errorMessage) {
            document.getElementById('spinner').classList.add('is-hidden');
            var titleElement = document.createElement('h2');
            titleElement.innerText = 'Can\'t generate AsciiDoc';
            var errorMessageElement = document.createElement('div');
            errorMessageElement.innerText = errorMessage;
            var messageElement = document.getElementById('message');
            messageElement.innerText = '';
            messageElement.appendChild(titleElement);
            messageElement.appendChild(errorMessageElement);
          })
        .withUserObject(this)
        .asciidocify();
  }

  convertAsciiDoc();
</script>
